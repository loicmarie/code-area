<link rel="import" href="../polymer/polymer.html">

<link rel=stylesheet href="../codemirror/lib/codemirror.css">
<!-- <link rel=stylesheet href="../codemirror/doc/docs.css"> -->
<script src="../codemirror/lib/codemirror.js"></script>
<script src="../codemirror/mode/xml/xml.js"></script>
<script src="../codemirror/mode/javascript/javascript.js"></script>
<script src="../codemirror/mode/css/css.js"></script>
<script src="../codemirror/mode/htmlmixed/htmlmixed.js"></script>
<script src="../codemirror/addon/edit/matchbrackets.js"></script>

<!-- <script src="../codemirror/doc/activebookmark.js"></script> -->

<style>
  .CodeMirror { height: auto; border: 1px solid #ddd; }
  .CodeMirror-scroll { max-height: 200px; }
  .CodeMirror pre { padding-left: 7px; line-height: 1.25; }
</style>

<!--
`code-area`
Polymer element wrapping CodeMirror (highlighting syntax, plugins and options)

@demo demo/index.html
-->

<dom-module id="code-area">
  <template>
    <style>
      :host {
        display: block;
      }
      #editor1-pane,
      #editor2-pane {
          position:relative;
          display: block;
          width: 100%;
          height: 200px;
          border: solid 1px #bbb;
      }
      #editor1,
      #editor2 {
          font-size: 9pt;
      }
    </style>
      <div hidden><content id="content"></content></div>
    <h2>Hello [[prop1]]</h2>
    <div id="editor1-pane"><textarea id="editor"></textarea></div>
  </template>

  <script>
    Polymer({

      is: 'code-area',

      properties: {
        /** The starting value of the editor. */
        value: {
          type: String,
          value: '',
          observer: '_propertyHandler'
        },
        /** The mode to use. When not given, this will default to the first mode that was loaded. It may be a string, which either simply names the mode or is a MIME type associated with the mode. Alternatively, it may be an object containing configuration options for the mode, with a name property that names the mode (for example {name: "javascript", json: true}). The demo pages for each mode contain information about what configuration parameters the mode supports. You can ask CodeMirror which modes and MIME types are loaded with the CodeMirror.listModes and CodeMirror.listMIMEs functions. */
        mode: {
          type: String,
          value: 'xml',
          observer: '_propertyHandler'
        },
        /** The theme to style the editor with. You must make sure the CSS file defining the corresponding .cm-s-[name] styles is loaded (see the theme directory in the distribution). The default is "default", for which colors are included in codemirror.css. It is possible to use multiple theming classes at onceâ€”for example "foo bar" will assign both the cm-s-foo and the cm-s-bar classes to the editor. */
        theme: {
          type: String,
          value: 'default',
          observer: '_propertyHandler'
        },
        /** How many spaces a block (whatever that means in the edited language) should be indented. The default is 2. */
        indentUnit: {
          type: Number,
          value: 2,
          observer: '_propertyHandler'
        },
        /** Whether to use the context-sensitive indentation that the mode provides (or just indent the same as the line before). Defaults to true. */
        noSmartIndent: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** The width of a tab character. Defaults to 4. */
        tabSize: {
          type: Number,
          value: 4,
          observer: '_propertyHandler'
        },
        /** Whether, when indenting, the first N*tabSize spaces should be replaced by N tabs. Default is false. */
        indentWithTabs: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** Configures whether the editor should re-indent the current line when a character is typed that might change its proper indentation (only works if the mode supports indentation). Default is true. */
        noElectricChars: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** When turned on (default is off), this will automatically clear lines consisting only of whitespace when the cursor leaves them. This is mostly useful to prevent auto indentation from introducing trailing whitespace in a file. */
        autoClearEmptyLines: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** Configures the keymap to use. The default is "default", which is the only keymap defined in codemirror.js itself. Extra keymaps are found in the keymap directory. See the section on keymaps for more information. */
        keyMap: {
          type: String,
          value: 'default',
          observer: '_propertyHandler'
        },
        /** Can be used to specify extra keybindings for the editor, alongside the ones defined by keyMap. Should be either null, or a valid keymap value. */
        extraKeys: {
          type: Object,
          value: null,
          observer: '_propertyHandler'
        },
        /** Whether CodeMirror should scroll or wrap for long lines. Defaults to false (scroll). */
        lineWrapping: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** Whether to show line numbers to the left of the editor. */
        lineNumbers: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** At which number to start counting lines. Default is 1. */
        firstLineNumber: {
          type: Number,
          value: 1,
          observer: '_propertyHandler'
        },
        /** Can be used to force a 'gutter' (empty space on the left of the editor) to be shown even when no line numbers are active. This is useful for setting markers. */
        gutter: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** When enabled (off by default), this will make the gutter stay visible when the document is scrolled horizontally. */
        fixedGutter: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** Whether the cursor should be drawn when a selection is active. Defaults to false. */
        showCursorWhenSelecting: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** This disables editing of the editor content by the user. If the special value "nocursor" is given (instead of simply true), focusing of the editor is also disallowed. */
        readOnly: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** Determines whether brackets are matched whenever the cursor is moved next to a bracket. */
        noMatchBrackets: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** Half-period in milliseconds used for cursor blinking. The default blink rate is 530ms. */
        cursorBlinkRate: {
          type: Number,
          value: 530,
          observer: '_propertyHandler'
        },
        /** See workTime property below **/
        workDelay: {
          type: Number,
          value: 300,
          observer: '_propertyHandler'
        },
        /** Highlighting is done by a pseudo background-thread that will work for workTime milliseconds, and then use timeout to sleep for workDelay milliseconds. The defaults are 200 and 300, you can change these options to make the highlighting more or less aggressive. */
        workTime: {
          type: Number,
          value: 200,
          observer: '_propertyHandler'
        },
        /** Indicates how quickly CodeMirror should poll its input textarea for changes. Most input is captured by events, but some things, like IME input on some browsers, doesn't generate events that allow CodeMirror to properly detect it. Thus, it polls. Default is 100 milliseconds. */
        pollInterval: {
          type: Number,
          value: 100,
          observer: '_propertyHandler'
        },
        /** The maximum number of undo levels that the editor stores. Defaults to 40. */
        undoDepth: {
          type: Number,
          value: 40,
          observer: '_propertyHandler'
        },
        /** The tab index to assign to the editor. If not given, no tab index will be assigned. */
        tabindex: {
          type: Number,
          value: 0,
          observer: '_propertyHandler'
        },
        /** Can be used to make CodeMirror focus itself on initialization. Defaults to off. When fromTextArea is used, and no explicit value is given for this option, it will be set to true when either the source textarea is focused, or it has an autofocus attribute and no other element is focused. */
        autofocus: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** Controls whether drag-and-drop is enabled. On by default. */
        noDragDrop: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        codeMirror: {
          type: Object
        }
      },
      ready: function() {
          var textarea = this.$.editor;
          this.codeMirror = CodeMirror.fromTextArea(textarea);
          for (var prop in this.properties){
            this.codeMirror.setOption(prop, this[prop]);
          }
          this.codeMirror.setValue(Polymer.dom(this.$.content).parentNode.innerHTML);
          this.codeMirror.refresh();

    });
  </script>
</dom-module>
