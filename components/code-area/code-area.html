<link rel="import" href="../polymer/polymer.html">

<link rel=stylesheet href="../codemirror/lib/codemirror.css">
<!-- <link rel=stylesheet href="../codemirror/doc/docs.css"> -->
<script src="../codemirror/lib/codemirror.js"></script>

<!-- <script rel=stylesheet href="../codemirror/addon/dialog/dialog.css"></script>
<script rel=stylesheet href="../codemirror/addon/dialog/fullscreen.css"></script>
<script rel=stylesheet href="../codemirror/addon/fold/foldgutter.css"></script>
<script rel=stylesheet href="../codemirror/addon/hint/show-hint.css"></script>
<script rel=stylesheet href="../codemirror/addon/lint/lint.css"></script>
<script rel=stylesheet href="../codemirror/addon/merge/merge.css"></script>
<script rel=stylesheet href="../codemirror/addon/scroll/simplescrollbar.css"></script>
<script rel=stylesheet href="../codemirror/addon/search/matchesonscrollbar.css"></script>
<script rel=stylesheet href="../codemirror/addon/tern/tern.css"></script> -->

<!-- <script src="../codemirror/addon/comment/comment.js"></script>
<script src="../codemirror/addon/comment/continuecomment.js"></script>
<script src="../codemirror/addon/dialog/dialog.js"></script>
<script src="../codemirror/addon/display/autorefresh.js"></script>
<script src="../codemirror/addon/display/fullscreen.js"></script>
<script src="../codemirror/addon/display/fullscreen.js"></script>
<script src="../codemirror/addon/display/panel.js"></script>
<script src="../codemirror/addon/display/placeholder.js"></script>
<script src="../codemirror/addon/display/rulers.js"></script>
<script src="../codemirror/addon/edit/closebrackets.js"></script>
<script src="../codemirror/addon/edit/closetag.js"></script>
<script src="../codemirror/addon/edit/continuelist.js"></script>
<script src="../codemirror/addon/edit/matchbrackets.js"></script>
<script src="../codemirror/addon/edit/matchtags.js"></script>
<script src="../codemirror/addon/edit/trailingspace.js"></script>
<script src="../codemirror/addon/fold/brace-fold.js"></script>
<script src="../codemirror/addon/fold/comment-fold.js"></script>
<script src="../codemirror/addon/fold/foldcode.js"></script>
<script src="../codemirror/addon/fold/foldgutter.js"></script>
<script src="../codemirror/addon/fold/indent-fold.js"></script>
<script src="../codemirror/addon/fold/markdown-fold.js"></script>
<script src="../codemirror/addon/fold/xml-fold.js"></script>
<script src="../codemirror/addon/hint/anyword-hint.js"></script>
<script src="../codemirror/addon/hint/css-hint.js"></script>
<script src="../codemirror/addon/hint/html-hint.js"></script>
<script src="../codemirror/addon/hint/javascript-hint.js"></script>
<script src="../codemirror/addon/hint/show-hint.js"></script>
<script src="../codemirror/addon/hint/sql-hint.js"></script>
<script src="../codemirror/addon/hint/xml-hint.js"></script>
<script src="../codemirror/addon/lint/coffeescript-lint.js"></script>
<script src="../codemirror/addon/lint/css-lint.js"></script>
<script src="../codemirror/addon/lint/html-lint.js"></script>
<script src="../codemirror/addon/lint/javascript-lint.js"></script>
<script src="../codemirror/addon/lint/json-lint.js"></script>
<script src="../codemirror/addon/lint/lint.js"></script>
<script src="../codemirror/addon/lint/yaml-lint.js"></script>
<script src="../codemirror/addon/merge/merge.js"></script>
<script src="../codemirror/addon/runmode/colorize.js"></script>
<script src="../codemirror/addon/runmode/runmode-standalone.js"></script>
<script src="../codemirror/addon/runmode/runmode.js"></script>
<script src="../codemirror/addon/runmode/runmode.node.js"></script>
<script src="../codemirror/addon/scroll/annotatescrollbar.js"></script>
<script src="../codemirror/addon/scroll/scrollpastend.js"></script>
<script src="../codemirror/addon/scroll/simplescrollbar.js"></script>
<script src="../codemirror/addon/search/jump-to-line.js"></script>
<script src="../codemirror/addon/search/match-highlighter.js"></script>
<script src="../codemirror/addon/search/matchesonscrollbar.js"></script>
<script src="../codemirror/addon/search/search.js"></script>
<script src="../codemirror/addon/search/searchcursor.js"></script>
<script src="../codemirror/addon/selection/active-line.js"></script>
<script src="../codemirror/addon/selection/mark-selection.js"></script>
<script src="../codemirror/addon/selection/selection-pointer.js"></script>
<script src="../codemirror/addon/tern/tern.js"></script>
<script src="../codemirror/addon/tern/worker.js"></script>
<script src="../codemirror/addon/wrap/hardwrap.js"></script> -->

<script src="../codemirror/addon/mode/simple.js"></script>
<script src="../codemirror/addon/mode/loadmode.js"></script>
<!-- <script src="../codemirror/addon/mode/multiplex_test.js"></script> -->
<script src="../codemirror/addon/mode/multiplex.js"></script>
<script src="../codemirror/addon/mode/overlay.js"></script>
<script src="../codemirror/mode/xml/xml.js"></script>
<script src="../codemirror/mode/clike/clike.js"></script>
<script src="../codemirror/mode/apl/apl.js"></script>
<script src="../codemirror/mode/css/css.js"></script>
<script src="../codemirror/mode/javascript/javascript.js"></script>
<script src="../codemirror/mode/python/python.js"></script>
<script src="../codemirror/mode/dockerfile/dockerfile.js"></script>
<script src="../codemirror/mode/htmlmixed/htmlmixed.js"></script>
<script src="../codemirror/addon/edit/matchbrackets.js"></script>

<!-- <script src="../codemirror/doc/activebookmark.js"></script> -->

<style>
  .CodeMirror { height: auto; border: 1px solid #ddd; }
  .CodeMirror-scroll { max-height: 200px; }
  .CodeMirror pre { padding-left: 7px; line-height: 1.25; }
</style>

<!--
`code-area`
Polymer element wrapping CodeMirror (highlighting syntax, plugins and options)

@demo demo/index.html
-->

<dom-module id="code-area">
  <template>
    <style>
      :host {
        display: block;
      }
      #editor1-pane,
      #editor2-pane {
          position:relative;
          display: block;
          width: 100%;
          height: 200px;
          border: solid 1px #bbb;
      }
      #editor1,
      #editor2 {
          font-size: 9pt;
      }
    </style>
    <div hidden><content id="content"></content></div>
    <div id="editor1-pane">
      <textarea id="editor"></textarea>
    </div>
  </template>

  <script>
    Polymer({

      is: 'code-area',

      properties: {
        /** The starting value of the editor. */
        value: {
          type: String,
          value: '',
          observer: '_propertyHandler'
        },
        /** The mode to use. When not given, this will default to the first mode that was loaded. It may be a string, which either simply names the mode or is a MIME type associated with the mode. Alternatively, it may be an object containing configuration options for the mode, with a name property that names the mode (for example {name: "javascript", json: true}). The demo pages for each mode contain information about what configuration parameters the mode supports. You can ask CodeMirror which modes and MIME types are loaded with the CodeMirror.listModes and CodeMirror.listMIMEs functions. */
        mode: {
          type: String,
          value: 'xml',
          observer: '_propertyHandler'
        },
        /** The theme to style the editor with. You must make sure the CSS file defining the corresponding .cm-s-[name] styles is loaded (see the theme directory in the distribution). The default is "default", for which colors are included in codemirror.css. It is possible to use multiple theming classes at onceâ€”for example "foo bar" will assign both the cm-s-foo and the cm-s-bar classes to the editor. */
        theme: {
          type: String,
          value: 'default',
          observer: '_propertyHandler'
        },
        /** How many spaces a block (whatever that means in the edited language) should be indented. The default is 2. */
        indentUnit: {
          type: Number,
          value: 2,
          observer: '_propertyHandler'
        },
        /** Whether to use the context-sensitive indentation that the mode provides (or just indent the same as the line before). Defaults to true. */
        noSmartIndent: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** The width of a tab character. Defaults to 4. */
        tabSize: {
          type: Number,
          value: 4,
          observer: '_propertyHandler'
        },
        /** Whether, when indenting, the first N*tabSize spaces should be replaced by N tabs. Default is false. */
        indentWithTabs: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** Configures whether the editor should re-indent the current line when a character is typed that might change its proper indentation (only works if the mode supports indentation). Default is true. */
        noElectricChars: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** When turned on (default is off), this will automatically clear lines consisting only of whitespace when the cursor leaves them. This is mostly useful to prevent auto indentation from introducing trailing whitespace in a file. */
        autoClearEmptyLines: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** Configures the keymap to use. The default is "default", which is the only keymap defined in codemirror.js itself. Extra keymaps are found in the keymap directory. See the section on keymaps for more information. */
        keyMap: {
          type: String,
          value: 'default',
          observer: '_propertyHandler'
        },
        /** Can be used to specify extra keybindings for the editor, alongside the ones defined by keyMap. Should be either null, or a valid keymap value. */
        extraKeys: {
          type: Object,
          value: null,
          observer: '_propertyHandler'
        },
        /** Whether CodeMirror should scroll or wrap for long lines. Defaults to false (scroll). */
        lineWrapping: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** Whether to show line numbers to the left of the editor. */
        lineNumbers: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** At which number to start counting lines. Default is 1. */
        firstLineNumber: {
          type: Number,
          value: 1,
          observer: '_propertyHandler'
        },
        /** A function `function(integer)` used to format line numbers. The function is passed the current line number. Default prints the line number verbatim. */
        lineNumberFormatter: {
          type: String,
          value: undefined
        },
        /** When (function) given, this function will be called every time the content of the editor is changed. It will be given the editor instance as first argument, and an {from, to, text, next} object containing information about the changes that occurred as second argument. from and to are the positions (in the pre-change coordinate system) where the change started and ended (for example, it might be {ch:0, line:18} if the position is at the beginning of line #19). text is an array of strings representing the text that replaced the changed range (split by line). If multiple changes happened during a single operation, the object will have a next property pointing to another change object (which may point to another, etc). */
        onChange: {
          type: String,
          value: 'function(){}',
        },
        /** Will be called (function) when the cursor or selection moves, or any change is made to the editor content. */
        onCursorActivity: {
          type: String,
          value: 'function(){}'
        },
        /** When given (function), will be called whenever the view port of the editor changes (due to scrolling, editing, or any other factor). It will be passed three arguments, the editor instance, the start of the viewport, and its end. */
        onViewportChange: {
          type: String,
          value: 'function(){}'
        },
        /** When given (function), will be called whenever the editor gutter (the line-number area) is clicked. Will be given the editor instance as first argument, the (zero-based) number of the line that was clicked as second argument, and the raw mousedown event object as third argument. */
        onGutterClick: {
          type: String,
          value: 'function(){}'
        },
        /** The given functions will be called whenever the editor is focused. */
        onFocus: {
          type: String,
          value: 'function(){}'
        },
        /** The given functions will be called whenever the editor is unfocused. */
        onBlur: {
          type: String,
          value: 'function(){}'
        },
        /** When given, will be called whenever the editor is scrolled. */
        onScroll: {
          type: String,
          value: 'function(){}'
        },
        /** Will be called whenever CodeMirror updates its DOM display. */
        onUpdate: {
          type: String,
          value: 'function(){}'
        },
        /** Can be used to force a 'gutter' (empty space on the left of the editor) to be shown even when no line numbers are active. This is useful for setting markers. */
        gutter: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** When enabled (off by default), this will make the gutter stay visible when the document is scrolled horizontally. */
        fixedGutter: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** Whether the cursor should be drawn when a selection is active. Defaults to false. */
        showCursorWhenSelecting: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** This disables editing of the editor content by the user. If the special value "nocursor" is given (instead of simply true), focusing of the editor is also disallowed. */
        readOnly: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** Determines whether brackets are matched whenever the cursor is moved next to a bracket. */
        noMatchBrackets: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** Half-period in milliseconds used for cursor blinking. The default blink rate is 530ms. */
        cursorBlinkRate: {
          type: Number,
          value: 530,
          observer: '_propertyHandler'
        },
        /** See workTime property below **/
        workDelay: {
          type: Number,
          value: 300,
          observer: '_propertyHandler'
        },
        /** Highlighting is done by a pseudo background-thread that will work for workTime milliseconds, and then use timeout to sleep for workDelay milliseconds. The defaults are 200 and 300, you can change these options to make the highlighting more or less aggressive. */
        workTime: {
          type: Number,
          value: 200,
          observer: '_propertyHandler'
        },
        /** Indicates how quickly CodeMirror should poll its input textarea for changes. Most input is captured by events, but some things, like IME input on some browsers, doesn't generate events that allow CodeMirror to properly detect it. Thus, it polls. Default is 100 milliseconds. */
        pollInterval: {
          type: Number,
          value: 100,
          observer: '_propertyHandler'
        },
        /** The maximum number of undo levels that the editor stores. Defaults to 40. */
        undoDepth: {
          type: Number,
          value: 40,
          observer: '_propertyHandler'
        },
        /** The tab index to assign to the editor. If not given, no tab index will be assigned. */
        tabindex: {
          type: Number,
          value: 0,
          observer: '_propertyHandler'
        },
        /** Can be used to make CodeMirror focus itself on initialization. Defaults to off. When fromTextArea is used, and no explicit value is given for this option, it will be set to true when either the source textarea is focused, or it has an autofocus attribute and no other element is focused. */
        autofocus: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** Controls whether drag-and-drop is enabled. On by default. */
        noDragDrop: {
          type: Boolean,
          value: false,
          observer: '_propertyHandler'
        },
        /** When given (function), this will be called when the editor is handling a dragenter, dragover, or drop event. It will be passed the editor instance and the event object as arguments. The callback can choose to handle the event itself, in which case it should return true to indicate that CodeMirror should not do anything further. */
        onDragEvent: {
          type: 'String',
          value: 'function(){}'
        },
        /** This provides a rather low-level hook into CodeMirror's key handling. If provided, this function will be called on every keydown, keyup, and keypress event that CodeMirror captures. It will be passed two arguments, the editor instance and the key event. This key event is pretty much the raw key event, except that a stop() method is always added to it. You could feed it to, for example, jQuery.Event to further normalize it. This function can inspect the key event, and handle it if it wants to. It may return true to tell CodeMirror to ignore the event. Be wary that, on some browsers, stopping a keydown does not stop the keypress from firing, whereas on others it does. If you respond to an event, you should probably inspect its type property and only do something when it is keydown (or keypress for actions that need character data). */
        onKeyEvent: {
          type: 'String',
          value: 'function(){}'
        },
        /** The codeMirror object is always accessible if you want more configuration options */
        codeMirror: {
          type: Object
        }
      },
      _propertyHandler: function(){},
      ready: function() {
          var textarea = this.$.editor;
          this.codeMirror = CodeMirror.fromTextArea(textarea);
          for (var prop in this.properties){
            if (this[prop]) {
              this.codeMirror.setOption(prop, this[prop]);
            }
          }
          this.codeMirror.on('change', new Function('return ' + this.onChange + '()'));
          this.codeMirror.setValue(Polymer.dom(this.$.content).parentNode.innerHTML.replace(/&amp;/g,'&'));
          this.codeMirror.refresh();
      }
    });
  </script>
</dom-module>
